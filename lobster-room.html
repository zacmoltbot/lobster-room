<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Lobster Room ‚Äî OpenClaw Dashboard</title>
  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    :root{--bg:#0a0a0f;--surface:rgba(255,255,255,0.03);--surfaceHover:rgba(255,255,255,0.045);--border:rgba(255,255,255,0.06);--accent:#6366f1;--accent2:#9333ea;--green:#4ade80;--yellow:#facc15;--red:#f87171;--orange:#fb923c;--purple:#a78bfa;--text:#e5e5e5;--textStrong:#ffffff;--muted:#737373;--dim:#525252;}
    body{font-family:-apple-system,BlinkMacSystemFont,'SF Pro','Helvetica Neue',sans-serif;background:var(--bg);color:var(--text);min-height:100vh;padding:20px}
    a{color:inherit}
    .container{max-width:1440px;margin:0 auto}

    .header{display:flex;align-items:center;justify-content:space-between;margin-bottom:16px;flex-wrap:wrap;gap:10px}
    .header-left{display:flex;align-items:center;gap:12px}
    .avatar{width:42px;height:42px;border-radius:12px;background:linear-gradient(135deg,var(--accent),var(--accent2));display:flex;align-items:center;justify-content:center;font-size:20px}
    .title{display:flex;flex-direction:column;gap:2px}
    .title h1{font-size:18px;font-weight:800;color:var(--textStrong)}
    .title .sub{font-size:12px;color:var(--dim)}
    .header-right{display:flex;align-items:center;gap:10px}
    .btn{background:var(--surface);border:1px solid var(--border);padding:7px 12px;border-radius:10px;color:var(--muted);font-size:12px;cursor:pointer;transition:all .15s;text-decoration:none;display:inline-flex;align-items:center;gap:8px}
    .btn:hover{background:var(--surfaceHover);color:var(--textStrong)}

    .room{position:relative;border:1px solid var(--border);background:var(--surface);border-radius:18px;min-height:720px;overflow:hidden}
    .room::before{content:'';position:absolute;inset:-100px;background:radial-gradient(600px 300px at 20% 15%, rgba(99,102,241,.20), transparent 60%), radial-gradient(500px 260px at 80% 85%, rgba(147,51,234,.16), transparent 55%);opacity:.7;pointer-events:none}

    .legend{position:absolute;left:14px;top:14px;display:flex;flex-wrap:wrap;gap:6px;z-index:5}
    .chip{font-size:11px;color:var(--muted);border:1px solid var(--border);background:rgba(0,0,0,.15);padding:6px 10px;border-radius:999px;backdrop-filter: blur(6px)}
    .chip b{color:var(--textStrong)}

    .host-zone{position:absolute;width:44%;height:42%;border:1px dashed rgba(255,255,255,.12);border-radius:18px;background:rgba(0,0,0,.12);backdrop-filter: blur(4px)}
    .host-zone .host-label{position:absolute;left:12px;top:10px;font-size:11px;color:var(--dim);letter-spacing:.08em;text-transform:uppercase}

    /* Top-left, top-right, bottom-left, bottom-right */
    .hz-tl{left:18px;top:18px}
    .hz-tr{right:18px;top:18px}
    .hz-bl{left:18px;bottom:18px}
    .hz-br{right:18px;bottom:18px}

    .lobster{position:absolute;display:flex;flex-direction:column;align-items:center;gap:6px;transform:translate(-50%,-50%);user-select:none}
    .lobster .icon{font-size:28px;filter: drop-shadow(0 8px 16px rgba(0,0,0,.35));}
    .lobster .name{font-size:11px;color:var(--textStrong);font-weight:700;max-width:140px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}

    .bubble{display:flex;align-items:center;gap:6px;font-size:11px;color:var(--text);padding:6px 10px;border-radius:999px;border:1px solid var(--border);background:rgba(0,0,0,.22);backdrop-filter: blur(6px)}
    .b-dot{width:8px;height:8px;border-radius:50%}

    .b-reply .b-dot{background:var(--green)}
    .b-think .b-dot{background:var(--purple)}
    .b-tool .b-dot{background:var(--accent)}
    .b-wait .b-dot{background:var(--yellow)}
    .b-err .b-dot{background:var(--red)}

    .footer{margin-top:10px;color:var(--dim);font-size:12px;display:flex;justify-content:space-between;gap:10px;flex-wrap:wrap}
    code{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace;font-size:11px;color:var(--muted)}
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <div class="header-left">
        <div class="avatar">ü¶û</div>
        <div class="title">
          <h1>Lobster Room</h1>
          <div class="sub">Bird‚Äôs-eye room view ‚Äî hosts in corners, agents as lobsters, status bubbles above.</div>
        </div>
      </div>
      <div class="header-right">
        <a class="btn" href="/">‚Üê Dashboard</a>
        <button class="btn" id="btn-refresh">Refresh now</button>
      </div>
    </div>

    <div class="room" id="room">
      <div class="legend" id="legend"></div>
      <div class="host-zone hz-tl"><div class="host-label">host-a</div></div>
      <div class="host-zone hz-tr"><div class="host-label">host-b</div></div>
      <div class="host-zone hz-bl"><div class="host-label">host-c</div></div>
      <div class="host-zone hz-br"><div class="host-label">host-d</div></div>
    </div>

    <div class="footer">
      <div>Data source: <code>MVP mock</code> (next: poll + multi-gateway aggregate)</div>
      <div id="ts">‚Äî</div>
    </div>
  </div>

  <script>
    const STATES = [
      {key:'reply', cls:'b-reply', label:'üí¨ replying'},
      {key:'think', cls:'b-think', label:'üß† thinking'},
      {key:'tool',  cls:'b-tool',  label:'üîß tool'},
      {key:'wait',  cls:'b-wait',  label:'‚è≥ waiting'},
      {key:'err',   cls:'b-err',   label:'‚ö†Ô∏è error'},
    ];

    // MVP: purely mock; shaped to what we'll likely want later.
    const MODEL = {
      hosts: [
        {id:'host-a', zone:'tl'},
        {id:'host-b', zone:'tr'},
        {id:'host-c', zone:'bl'},
        {id:'host-d', zone:'br'},
      ],
      agents: [
        {id:'main@host-a', host:'host-a', name:'main', x:22, y:28, state:'reply'},
        {id:'work@host-a', host:'host-a', name:'work', x:30, y:18, state:'think'},
        {id:'group@host-b', host:'host-b', name:'group', x:74, y:24, state:'tool'},
        {id:'notion@host-c', host:'host-c', name:'notion-bot', x:26, y:76, state:'wait'},
        {id:'cron@host-d', host:'host-d', name:'cron', x:78, y:74, state:'wait'},
      ]
    };

    function zoneBounds(zone){
      // percent-based bounds within room
      if(zone==='tl') return {x1:4,  y1:4,  x2:48, y2:46};
      if(zone==='tr') return {x1:52, y1:4,  x2:96, y2:46};
      if(zone==='bl') return {x1:4,  y1:54, x2:48, y2:96};
      if(zone==='br') return {x1:52, y1:54, x2:96, y2:96};
      return {x1:4,y1:4,x2:96,y2:96};
    }

    function stateMeta(key){
      return STATES.find(s=>s.key===key) || STATES[3];
    }

    function renderLegend(){
      const el = document.getElementById('legend');
      el.innerHTML = '';
      for(const s of STATES){
        const chip = document.createElement('div');
        chip.className = 'chip';
        chip.innerHTML = `<b>${s.label.split(' ')[0]}</b> ${s.label.split(' ').slice(1).join(' ')}`;
        el.appendChild(chip);
      }
    }

    function renderAgents(){
      const room = document.getElementById('room');
      // remove existing
      Array.from(room.querySelectorAll('.lobster')).forEach(n=>n.remove());

      for(const a of MODEL.agents){
        const meta = stateMeta(a.state);
        const b = zoneBounds((MODEL.hosts.find(h=>h.id===a.host)||{}).zone);
        // if x/y not provided, place randomly inside zone
        const px = a.x != null ? a.x : (b.x1 + Math.random()*(b.x2-b.x1));
        const py = a.y != null ? a.y : (b.y1 + Math.random()*(b.y2-b.y1));

        const wrap = document.createElement('div');
        wrap.className = 'lobster';
        wrap.style.left = px + '%';
        wrap.style.top  = py + '%';

        wrap.innerHTML = `
          <div class="bubble ${meta.cls}"><span class="b-dot"></span><span>${meta.label}</span></div>
          <div class="icon">ü¶û</div>
          <div class="name" title="${a.id}">${a.name} <span style="color:var(--dim);font-weight:600">(${a.host})</span></div>
        `;

        room.appendChild(wrap);
      }
    }

    function tickMock(){
      // random state churn (MVP stand-in for real polling)
      for(const a of MODEL.agents){
        if(Math.random() < 0.35){
          const next = STATES[Math.floor(Math.random()*STATES.length)].key;
          a.state = next;
        }
      }
      renderAgents();
      document.getElementById('ts').textContent = 'Updated: ' + new Date().toLocaleString();
    }

    function init(){
      renderLegend();
      renderAgents();
      tickMock();
      setInterval(tickMock, 1400);
      document.getElementById('btn-refresh').addEventListener('click', tickMock);
    }

    init();
  </script>
</body>
</html>
